<!DOCTYPE html>
<html lang="vi">
<head>
  <th:block th:replace="~{user/_meta}" />
  <title>Lịch sử đơn hàng của khách</title>
</head>
<body>
<th:block th:replace="~{admin/_headerAdmin}" />
<section class="section-content">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center py-3">
      <h3 class="mb-0">Lịch sử đơn hàng - <span th:text="${khachHang.hoten}"></span></h3>
      <a th:href="@{'/admin/khachhang/view/' + ${khachHang.idKhachHang}}" class="btn btn-secondary btn-sm">← Quay lại hồ sơ</a>
    </div>

    <div class="card">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped mb-0 align-middle">
            <thead class="table-light">
              <tr>
                <th>Mã</th>
                <th>Ngày</th>
                <th>Trạng thái</th>
                <th>Phương thức giao</th>
                <th>Tạm tính</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
            <tr th:each="o : ${ordersPage.content}">
              <td th:text="${o.idHoadon}"></td>
              <td th:text="${#dates.format(o.ngaytao,'dd/MM/yyyy')}"></td>
              <td th:text="${o.trangthai}"></td>
              <td th:text="${o.giaohang}"></td>
              <td>
                <span th:text="${#numbers.formatInteger(o.hoaDonChiTiets.stream().mapToInt(ct -> (ct.giamgia == 0 ? ct.gia : (ct.gia * (100-ct.giamgia)/100)) * ct.soluong).sum(),3,'POINT')} + ' đ'"></span>
              </td>
              <td><a th:href="@{'/admin/hoadon/' + ${o.idHoadon}}" class="btn btn-outline-primary btn-sm">Chi tiết</a></td>
            </tr>
            <tr th:if="${ordersPage.content.size()} == 0">
              <td colspan="6" class="text-center py-4">Không có đơn hàng</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <nav th:if="${ordersPage.totalPages} > 1" class="mt-3">
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item" th:classappend="${ordersPage.first}? 'disabled'">
          <a class="page-link" th:href="@{'/admin/khachhang/view/' + ${khachHang.idKhachHang} + '/orders'(page=${currentPage-1}, size=${pageSize})}">&laquo;</a>
        </li>
        <li class="page-item" th:each="i : ${#numbers.sequence(0, ordersPage.totalPages -1)}" th:classappend="${i}==${currentPage}? 'active'">
          <a class="page-link" th:text="${i+1}" th:href="@{'/admin/khachhang/view/' + ${khachHang.idKhachHang} + '/orders'(page=${i}, size=${pageSize})}"></a>
        </li>
        <li class="page-item" th:classappend="${ordersPage.last}? 'disabled'">
          <a class="page-link" th:href="@{'/admin/khachhang/view/' + ${khachHang.idKhachHang} + '/orders'(page=${currentPage+1}, size=${pageSize})}">&raquo;</a>
        </li>
      </ul>
    </nav>
  </div>
</section>
<th:block th:replace="~{admin/_footerAdmin}" />
</body>
</html>
