<!DOCTYPE html>
<html lang="vi">
<head>
  <th:block th:replace="~{user/_meta}" />
  <title>MEDISALE - Nhà thuốc trực tuyến</title>
  <script th:src="@{/js/toast.js}" type="module"></script>
  <script th:src="@{/js/home.js}" type="module"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    /* Hero */
    .hero { position:relative; padding:70px 0 60px; background:linear-gradient(135deg,#0d6efd 0%,#5b9dff 60%,#cbe4ff 100%); color:#fff; overflow:hidden; }
    .hero::after { content:""; position:absolute; inset:0; background:radial-gradient(circle at 80% 20%,rgba(255,255,255,.25),transparent 60%); pointer-events:none; }
    .hero h1 { font-weight:700; font-size:clamp(1.9rem,4vw,2.8rem); line-height:1.15; }
    .hero p.lead { font-size:1.05rem; max-width:640px; }
    .hero-cta .btn { padding:.85rem 1.4rem; font-weight:600; border-radius:.75rem; }
    .stat-badges { display:flex; flex-wrap:wrap; gap:1rem; margin-top:1.5rem; }
    .stat-badge { background:rgba(255,255,255,.15); backdrop-filter:blur(4px); padding:.75rem 1rem; border-radius:.75rem; font-size:.85rem; display:flex; align-items:center; gap:.5rem; }
    /* Feature band */
    .feature-band { background:#fff; border-radius:1rem; box-shadow:0 4px 18px -6px rgba(0,0,0,.08); padding:1.25rem 1rem; margin-top:-40px; position:relative; z-index:2; }
    .feature-item { display:flex; gap:.875rem; align-items:flex-start; }
    .feature-icon { width:46px; height:46px; display:flex; align-items:center; justify-content:center; border-radius:.75rem; background:linear-gradient(135deg,#0d6efd,#63a3ff); color:#fff; font-size:1.2rem; box-shadow:0 4px 12px -4px rgba(13,110,253,.4); }
    .feature-item h6 { margin:0 0 .25rem; font-weight:600; }
    .feature-item p { margin:0; font-size:.8rem; color:#6c757d; }
    /* Category / product shared */
    .section-title-wrap p { font-size:.9rem; }
    .category-card, .product-card { transition:all .35s ease; border-radius:1rem; }
    .category-card:hover, .product-card:hover { transform:translateY(-6px); box-shadow:0 10px 26px -10px rgba(0,0,0,.18); }
    .category-icon { width:60px; height:60px; background:rgba(13,110,253,0.08); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 4px; color:#0d6efd; }
    .product-img { display:block; padding-top:100%; position:relative; overflow:hidden; border-radius:.75rem; }
    .product-img img { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }
    .product-overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.25); opacity:0; transition:.3s; }
    .product-img:hover .product-overlay { opacity:1; }
    .product-badge { position:absolute; top:10px; left:10px; z-index:2; }
    .product-badge .badge { font-size:.65rem; padding:.45rem .6rem; letter-spacing:.5px; box-shadow:0 2px 4px rgba(0,0,0,.15); }
  .product-title { display:-webkit-box; -webkit-line-clamp:2; line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; font-size:.9rem; line-height:1.45; }
    .discount { animation:pulse 2s infinite; font-size:.65rem; padding:.35rem .55rem; }
    @keyframes pulse { 0%{transform:scale(1);} 50%{transform:scale(1.05);} 100%{transform:scale(1);} }
    /* Newsletter */
    .newsletter { background:#ffffff; border-radius:1rem; padding:2.2rem 1.5rem; box-shadow:0 4px 24px -8px rgba(0,0,0,.08); }
    .newsletter h4 { font-weight:600; }
    .newsletter .form-control { border-radius:.75rem 0 0 .75rem; }
    .newsletter .btn { border-radius:0 .75rem .75rem 0; font-weight:600; }
    /* Utility */
    .divider-text { text-transform:uppercase; font-size:.7rem; letter-spacing:1px; color:#6c757d; font-weight:600; margin:0 0 1.5rem; display:flex; align-items:center; gap:1rem; }
    .divider-text::before, .divider-text::after { content:""; flex:1; height:1px; background:linear-gradient(90deg,transparent,#d0d7e2,transparent); }
    @media (max-width:991.98px){ .feature-band { margin-top:-30px; } .feature-item p { display:none; } .hero { padding:56px 0 48px; } }
  </style>
</head>
<body class="bg-light">
  <th:block th:replace="~{user/_header}" />

  <!-- HERO -->
  <section class="hero">
    <div class="container position-relative">
      <div class="row align-items-center">
        <div class="col-lg-7 mb-4 mb-lg-0">
          <h1>Giải pháp chăm sóc sức khỏe <span style="background:linear-gradient(90deg,#ffe259,#ffa751); -webkit-background-clip:text; background-clip:text; color:transparent;">toàn diện</span> cho gia đình bạn</h1>
          <p class="lead mt-3">Mua thuốc, thực phẩm chức năng và thiết bị y tế chính hãng. Giao nhanh – Tư vấn tận tâm – Ưu đãi mỗi ngày.</p>
          <div class="hero-cta d-flex flex-wrap gap-3 mt-4">
            <a th:href="@{/loai-all}" class="btn btn-light text-primary shadow-sm"><i class="fas fa-th-large me-2"></i>Khám phá danh mục</a>
            <a th:href="@{/search}" class="btn btn-outline-light"><i class="fas fa-search me-2"></i>Tìm sản phẩm</a>
          </div>
          <div class="stat-badges">
            <div class="stat-badge"><i class="fas fa-shield-alt"></i><span>Chính hãng 100%</span></div>
            <div class="stat-badge"><i class="fas fa-shipping-fast"></i><span>Giao nhanh 2h</span></div>
            <div class="stat-badge"><i class="fas fa-headset"></i><span>Dược sĩ tư vấn</span></div>
            <div class="stat-badge"><i class="fas fa-sync"></i><span>Đổi trả 7 ngày</span></div>
          </div>
        </div>
        <div class="col-lg-5 d-none d-lg-block">
          <img src="/static/img/570px-1.png" alt="Healthcare" class="img-fluid rounded-4 shadow" loading="lazy" />
        </div>
      </div>
    </div>
  </section>

  <!-- FEATURE BAND -->
  <div class="container">
    <div class="feature-band row g-3 g-md-4 text-center text-md-start">
      <div class="col-6 col-md-3">
        <div class="feature-item"><div class="feature-icon"><i class="fas fa-certificate"></i></div><div><h6>Hàng chuẩn GPP</h6><p>Đảm bảo nguồn gốc rõ ràng</p></div></div>
      </div>
      <div class="col-6 col-md-3">
        <div class="feature-item"><div class="feature-icon"><i class="fas fa-user-md"></i></div><div><h6>Dược sĩ hỗ trợ</h6><p>Tư vấn dùng thuốc an toàn</p></div></div>
      </div>
      <div class="col-6 col-md-3">
        <div class="feature-item"><div class="feature-icon"><i class="fas fa-box-open"></i></div><div><h6>Đóng gói bảo quản</h6><p>Giữ nguyên chất lượng</p></div></div>
      </div>
      <div class="col-6 col-md-3">
        <div class="feature-item"><div class="feature-icon"><i class="fas fa-lock"></i></div><div><h6>Bảo mật & an toàn</h6><p>Thanh toán được mã hóa</p></div></div>
      </div>
    </div>
  </div>

  <!-- Categories Section -->
  <section class="section-categories py-5 bg-white">
    <div class="container">
      <div class="section-header d-flex justify-content-between align-items-center mb-4 section-title-wrap">
        <div>
          <h2 class="section-title fw-bold mb-1">Danh mục sản phẩm</h2>
          <p class="text-muted mb-0">Khám phá các nhóm sản phẩm được quan tâm nhất</p>
        </div>
        <a class="btn btn-outline-primary" th:href="@{/loai-all}"><i class="fas fa-th-large me-2"></i>Xem tất cả</a>
      </div>
      <div class="row g-4">
        <div class="col-lg-2 col-md-3 col-6" th:each="loai : ${loais}">
          <a th:href="@{/loai(id=${loai.idLoai})}" class="text-decoration-none">
            <div class="card category-card h-100 border-0 shadow-sm">
              <div class="card-body text-center p-4">
                <div class="category-icon mb-2"><i class="fas fa-pills fa-lg"></i></div>
                <h6 class="category-title text-dark mb-0" th:text="${loai.tenLoai}"></h6>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- New Products Section -->
  <section class="section-products py-5">
    <div class="container">
      <div class="section-header d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="section-title fw-bold mb-1">Sản phẩm mới nhất</h2>
          <p class="text-muted mb-0">Khám phá các sản phẩm mới nhất của chúng tôi</p>
        </div>
      </div>

      <div class="row g-4">
        <div class="col-xl-3 col-lg-4 col-md-6" th:each="sanpham : ${sanphams}">
          <div class="card product-card h-100 border-0 shadow-sm">
            <div class="card-body p-3">
              <a th:href="@{/sanpham(id=${sanpham.idSanpham})}" class="product-img mb-3">
                <img th:src="@{/image/{url}(url=${sanpham.hinh})}" class="img-fluid" th:alt="${sanpham.tenSanpham}">
                <div class="product-overlay">
                  <i class="fas fa-search-plus"></i>
                </div>
              </a>
              
              <div class="product-info">
                <h6 class="product-title mb-2">
                  <a th:href="@{/sanpham(id=${sanpham.idSanpham})}" class="text-dark text-decoration-none">
                    <i class="fas fa-capsules me-2 text-primary"></i>
                    <span th:text="${sanpham.tenSanpham}"></span>
                  </a>
                </h6>

                <div class="product-price mb-3">
                  <div th:if="${sanpham.giamgia == 0}" class="d-flex align-items-center">
                    <i class="fas fa-tag text-primary me-2"></i>
                    <span class="price fw-bold text-primary">
                      <span th:text="${#numbers.formatInteger(sanpham.gia, 0, 'COMMA')}"></span>₫
                    </span>
                  </div>
                  <div th:if="${sanpham.giamgia > 0}" class="d-flex align-items-center gap-2">
                    <i class="fas fa-tags text-danger me-2"></i>
                    <span class="price fw-bold text-primary">
                      <span th:text="${#numbers.formatInteger(sanpham.gia * (100 - sanpham.giamgia) / 100, 0, 'COMMA')}"></span>₫
                    </span>
                    <span class="original-price text-decoration-line-through text-muted small">
                      <span th:text="${#numbers.formatInteger(sanpham.gia, 0, 'COMMA')}"></span>₫
                    </span>
                    <span class="discount badge bg-danger">
                      <i class="fas fa-percent me-1"></i>
                      <span th:text="${sanpham.giamgia}"></span>%
                    </span>
                  </div>
                </div>

                <div class="product-actions d-flex gap-2">
                  <button th:disabled="${sanpham.soluong == 0}" 
                          th:classappend="${sanpham.soluong == 0?'btn-danger':'btn-primary'}"
                          type="button" 
                          class="btn flex-grow-1 add-cart-item" 
                          th:data-id="${sanpham.idSanpham}"
                          th:data-name="${sanpham.tenSanpham}">
                    <i class="fas fa-cart-plus me-2"></i>
                    <span th:text="${sanpham.soluong == 0?'Hết hàng':'Thêm vào giỏ'}"></span>
                  </button>
                  <button th:if="${sanpham.soluong > 0}" 
                          type="button"
                          class="btn btn-outline-primary buy-now"
                          th:data-id="${sanpham.idSanpham}">
                    <i class="fas fa-bolt"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Sale Products Section -->
  <section class="section-products py-5 bg-white">
    <div class="container">
      <div class="section-header d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="section-title fw-bold mb-1">
            <i class="fas fa-fire text-danger me-2"></i>Sản phẩm giảm giá
          </h2>
          <p class="text-muted mb-0">Khám phá các sản phẩm đang giảm giá hot nhất</p>
        </div>
      </div>

      <div class="row g-4">
        <div class="col-xl-3 col-lg-4 col-md-6" th:each="sanpham : ${listSPGiamGia}">
          <div class="card product-card h-100 border-0 shadow-sm">
            <div class="card-body p-3">
              <!-- Product Image -->
              <a th:href="@{/sanpham(id=${sanpham.idSanpham})}" class="product-img mb-3">
                <img th:src="@{/image/{url}(url=${sanpham.hinh})}" class="img-fluid" th:alt="${sanpham.tenSanpham}">
                <div class="product-overlay">
                  <i class="fas fa-search-plus"></i>
                </div>
                <div class="product-badge">
                  <span class="badge bg-danger">
                    <i class="fas fa-bolt me-1"></i>Giảm giá
                  </span>
                </div>
              </a>
              
              <!-- Product Info -->
              <div class="product-info">
                <h6 class="product-title mb-2">
                  <a th:href="@{/sanpham(id=${sanpham.idSanpham})}" class="text-dark text-decoration-none">
                    <i class="fas fa-capsules me-2 text-primary"></i>
                    <span th:text="${sanpham.tenSanpham}"></span>
                  </a>
                </h6>

                <!-- Price Info -->
                <div class="product-price mb-3">
                  <div class="d-flex align-items-center gap-2">
                    <i class="fas fa-tags text-danger me-2"></i>
                    <span class="price fw-bold text-primary">
                      <span th:text="${#numbers.formatInteger(sanpham.gia * (100 - sanpham.giamgia) / 100, 0, 'COMMA')}"></span>₫
                    </span>
                    <span class="original-price text-decoration-line-through text-muted small">
                      <span th:text="${#numbers.formatInteger(sanpham.gia, 0, 'COMMA')}"></span>₫
                    </span>
                    <span class="discount badge bg-danger">
                      <i class="fas fa-percent me-1"></i>
                      <span th:text="${sanpham.giamgia}"></span>%
                    </span>
                  </div>
                </div>

                <!-- Product Actions -->
                <div class="product-actions d-flex gap-2">
                  <button th:disabled="${sanpham.soluong == 0}" 
                          th:classappend="${sanpham.soluong == 0?'btn-danger':'btn-primary'}"
                          type="button" 
                          class="btn flex-grow-1 add-cart-item" 
                          th:data-id="${sanpham.idSanpham}"
                          th:data-name="${sanpham.tenSanpham}">
                    <i class="fas fa-cart-plus me-2"></i>
                    <span th:text="${sanpham.soluong == 0?'Hết hàng':'Thêm vào giỏ'}"></span>
                  </button>
                  <button th:if="${sanpham.soluong > 0}" 
                          type="button"
                          class="btn btn-outline-primary buy-now"
                          th:data-id="${sanpham.idSanpham}">
                    <i class="fas fa-bolt"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <th:block th:replace="~{user/_footer}" />

  <div class="toast-container position-fixed bottom-0 start-0 p-3"></div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Xử lý thêm vào giỏ hàng
    document.querySelectorAll('.add-cart-item').forEach(button => {
      button.addEventListener('click', async function() {
        if(!this.disabled) {
          const productId = this.dataset.id;
          const productName = this.dataset.name;
          
          try {
            const response = await fetch('/cart/add', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                id: productId,
                quantity: 1
              })
            });

            const data = await response.json();
            
            if(data.success) {
              // Cập nhật số lượng trong giỏ hàng
              const cartCountElements = document.querySelectorAll('.cart-count');
              cartCountElements.forEach(element => {
                element.textContent = data.cartCount;
              });
              
              // Hiển thị toast thông báo
              showToast(`Đã thêm "${productName}" vào giỏ hàng`, 'success');
            } else {
              showToast(data.message || 'Có lỗi xảy ra', 'error');
            }
          } catch (error) {
            console.error('Error:', error);
            showToast('Có lỗi xảy ra khi thêm vào giỏ hàng', 'error');
          }
        }
      });
    });

    // Hàm hiển thị toast
    function showToast(message, type = 'success') {
      const toast = new Toast({
        message: message,
        type: type,
        duration: 3000
      });
      toast.show();
    }
  });
  </script>
</body>
</html>
