<!DOCTYPE html>
<html lang="vi">
<head>
  <th:block th:replace="~{user/_meta}" />
  <title>Đăng ký</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    .auth-wrapper { min-height:calc(100vh - 140px); display:flex; align-items:center; }
    .auth-card { border:0; border-radius:1rem; overflow:hidden; box-shadow:0 8px 32px -8px rgba(0,0,0,.15); }
    .auth-side { background:linear-gradient(135deg,#198754,#51c087); color:#fff; position:relative; }
    .auth-side::after { content:""; position:absolute; inset:0; background:radial-gradient(circle at 70% 25%,rgba(255,255,255,.25),transparent 60%); }
    .auth-side-content { position:relative; z-index:2; padding:2.5rem 2rem; }
    .auth-side h2 { font-weight:600; }
    .auth-form { padding:2.25rem 2rem; }
    .auth-form h4 { font-weight:600; }
    .form-floating>.form-control { padding-left:1rem; }
    .form-floating>label { padding-left:1rem; }
    .form-control:focus { border-color:#86b7fe; box-shadow:0 0 0 .25rem rgba(13,110,253,.25); }
    .btn-primary { padding:.75rem; font-weight:600; border-radius:.75rem; }
    .toggle-password { position:absolute; top:50%; right:.85rem; transform:translateY(-50%); cursor:pointer; color:#6c757d; }
    .alert { border:0; border-radius:.75rem; }
    .strength-bar { height:6px; background:#e9ecef; border-radius:4px; overflow:hidden; margin-top:.35rem; }
    .strength-bar div { height:100%; width:0; background:#dc3545; transition:width .35s ease, background .35s ease; }
    .password-hint { font-size:.7rem; color:#6c757d; }
    @media (max-width:991.98px){ .auth-side { display:none; } .auth-form { padding:2rem 1.5rem; } }
  </style>
</head>
<body class="bg-light">
  <th:block th:replace="~{user/_header}" />
  <div class="container auth-wrapper py-5">
    <div class="row justify-content-center w-100">
      <div class="col-lg-9 col-xl-8">
        <div class="card auth-card">
          <div class="row g-0 align-items-stretch">
            <div class="col-lg-5 auth-side d-flex">
              <div class="auth-side-content my-auto">
                <h2 class="mb-4">Tạo tài khoản mới</h2>
                <p class="mb-4">Đăng ký để tận hưởng mua sắm tiện lợi, lưu đơn & nhận ưu đãi thành viên.</p>
                <ul class="list-unstyled small opacity-75 mb-0">
                  <li class="mb-2"><i class="fas fa-check-circle me-2"></i>Tích điểm đổi quà</li>
                  <li class="mb-2"><i class="fas fa-check-circle me-2"></i>Theo dõi đơn hàng</li>
                  <li class="mb-2"><i class="fas fa-check-circle me-2"></i>Lịch sử & tái đặt nhanh</li>
                </ul>
              </div>
            </div>
            <div class="col-lg-7 bg-white">
              <div class="auth-form">
                <div th:if="${successMessage}" class="alert alert-success d-flex align-items-center" role="alert">
                  <i class="fas fa-check-circle me-2"></i><div th:text="${successMessage}"></div>
                </div>
                <div th:if="${errorMessage}" class="alert alert-danger d-flex align-items-center" role="alert">
                  <i class="fas fa-exclamation-circle me-2"></i><div th:text="${errorMessage}"></div>
                </div>
                <h4 class="mb-4">Đăng ký tài khoản</h4>
                <form th:action="@{/signup}" method="post" novalidate>
                  <div class="form-floating mb-3">
                    <input type="email" id="inputEmail" class="form-control" name="idUser" th:value="${user.idUser}" placeholder="Email" required>
                    <label for="inputEmail"><i class="fas fa-envelope me-2"></i>Email</label>
                  </div>
                  <div class="form-floating mb-2 position-relative">
                    <input type="password" id="inputPassword" class="form-control" name="matkhau" th:value="${user.matkhau}" placeholder="Mật khẩu" required>
                    <label for="inputPassword"><i class="fas fa-lock me-2"></i>Mật khẩu</label>
                    <span class="toggle-password" data-target="#inputPassword"><i class="fas fa-eye"></i></span>
                  </div>
                  <div class="strength-bar mb-3"><div id="pwStrength"></div></div>
                  <div class="form-floating mb-3">
                    <input type="text" id="inputFullname" class="form-control" name="hoten" th:value="${user.hoten}" placeholder="Họ và tên" required>
                    <label for="inputFullname"><i class="fas fa-user me-2"></i>Họ và tên</label>
                  </div>
                  <div class="form-floating mb-4">
                    <input type="text" id="inputPhoneNumber" class="form-control" name="sdt" th:value="${user.sdt}" pattern="0[0-9]{9}" placeholder="Số điện thoại" required title="Số điện thoại phải có 10 chữ số và bắt đầu bằng số 0">
                    <label for="inputPhoneNumber"><i class="fas fa-phone me-2"></i>Số điện thoại</label>
                  </div>
                  <button type="submit" class="btn btn-primary w-100 mb-3"><i class="fas fa-user-plus me-2"></i>Đăng ký</button>
                  <div class="text-center small">
                    Đã có tài khoản? <a th:href="@{/signin}" class="text-decoration-none">Đăng nhập</a>
                  </div>
                  <p class="mt-4 small text-muted mb-0">Bằng việc đăng ký bạn đồng ý với <a href="#" class="text-decoration-none">Điều khoản</a> & <a href="#" class="text-decoration-none">Chính sách bảo mật</a>.</p>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <th:block th:replace="~{user/_footer}" />
  <script>
    document.addEventListener('click', function(e){
      const toggle = e.target.closest('.toggle-password');
      if(!toggle) return;
      const input = document.querySelector(toggle.getAttribute('data-target'));
      if(!input) return;
      if(input.type === 'password') { input.type='text'; toggle.innerHTML='<i class="fas fa-eye-slash"></i>'; }
      else { input.type='password'; toggle.innerHTML='<i class="fas fa-eye"></i>'; }
    });
    const pwd = document.getElementById('inputPassword');
    const bar = document.getElementById('pwStrength');
    function scorePassword(v){ let s=0; if(!v) return s; const letters={}; for(const c of v){ letters[c]=(letters[c]||0)+1; s+=5.0/letters[c]; } const variations={digits:/\d/.test(v),lower:/[a-z]/.test(v),upper:/[A-Z]/.test(v),nonWords:/[^a-zA-Z0-9]/.test(v)}; let variationCount=0; for(const k in variations){ variationCount+=variations[k]?1:0;} s+= (variationCount-1)*10; return parseInt(s); }
    function updateStrength(){ const val=pwd.value; const sc=scorePassword(val); let w=0,col='#dc3545'; if(sc>70){w=100;col='#198754';} else if(sc>50){w=70;col='#0d6efd';} else if(sc>30){w=45;col='#fd7e14';} else if(sc>10){w=25;col='#ffc107';} else {w=10;col='#dc3545';} bar.style.width=w+'%'; bar.style.background=col; }
    if(pwd){ pwd.addEventListener('input',updateStrength); updateStrength(); }
  </script>
</body>
</html>
